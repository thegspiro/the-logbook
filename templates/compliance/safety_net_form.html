{% extends "base.html" %}

{% block title %}{% if object %}Edit{% else %}Create{% endif %} Safety Net{% endblock %}

{% block content %}
    <h1>{% if object %}üìù Edit{% else %}‚ûï Create{% endif %} Safety Net</h1>
    <hr>
    
    <div class="alert alert-info">
        <strong>Manpower:</strong> Enforcement Value = Minimum number of staff (e.g., 3). Position is ignored.<br>
        <strong>Qualification:</strong> Enforcement Value = Name of the required **Certification Standard** (e.g., Hazmat Tech). Position is required.
    </div>

    <div class="card shadow-sm col-lg-7">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">Safety Net Configuration</h5>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                
                {% for field in form %}
                    <div class="mb-3" id="field-{{ field.name }}" {% if field.name == 'position' and form.instance.type != 'QUALIFICATION' and not form.errors %}style="display:none;"{% endif %}>
                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                        {{ field }}
                        {% for error in field.errors %}
                            <small class="text-danger d-block">{{ error }}</small>
                        {% endfor %}
                        {% if field.help_text %}<small class="form-text text-muted">{{ field.help_text }}</small>{% endif %}
                    </div>
                {% endfor %}
                
                <button type="submit" class="btn btn-success me-2">Save Configuration</button>
                <a href="{% url 'compliance:safety_net_list' %}" class="btn btn-outline-secondary">Cancel</a>
            </form>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var typeField = document.getElementById('id_safety_net_type');
        var positionContainer = document.getElementById('field-position');
        
        function togglePositionField() {
            if (typeField.value === 'QUALIFICATION') {
                positionContainer.style.display = 'block';
            } else {
                positionContainer.style.display = 'none';
            }
        }
        
        // Initial check on load
        togglePositionField();
        
        // Check when the type changes
        if (typeField) {
            typeField.addEventListener('change', togglePositionField);
        }
    });
</script>
{% endblock %}
